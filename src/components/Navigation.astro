---
interface Props {
  currentPath?: string;
  logoSrc?: string;
  logoAlt?: string;
}

const { currentPath = '/', logoSrc, logoAlt = 'DC GTFS Dashboard' } = Astro.props;

const navItems = [
  { label: 'Feeds', href: '/' },
  { label: 'FAQ', href: '/faq' }
];
---

<header class="nav-header">
  <div class="nav-container">
    <a class="nav-logo" href="/" aria-label="Home">
      {logoSrc ? (
        <img src={logoSrc} alt={logoAlt} class="nav-logo-img" />
      ) : (
        <strong>DC GTFS Dashboard</strong>
      )}
    </a>

    <button
      class="nav-mobile-toggle"
      data-nav-toggle
      aria-controls="nav-menu"
      aria-expanded="false"
    >
      <span class="nav-mobile-label">Menu</span>
    </button>

    <nav class="nav-desktop">
      <ul class="nav-items">
        {navItems.map(item => (
          <li>
            <a
              class={currentPath === item.href ? 'nav-link active' : 'nav-link'}
              href={item.href}
            >
              {item.label}
            </a>
          </li>
        ))}
        <li>
          <button
            id="theme-toggle"
            class="theme-toggle"
            aria-label="Toggle theme"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path
                fill="currentColor" fill-rule="evenodd" d="M277.333 405.333v85.333h-42.667v-85.333zm99.346-58.824l60.34 60.34l-30.17 30.17l-60.34-60.34zm-241.359 0l30.17 30.17l-60.34 60.34l-30.17-30.17zM256 139.353c64.422 0 116.647 52.224 116.647 116.647c0 64.422-52.225 116.647-116.647 116.647A116.427 116.427 0 0 1 139.352 256c0-64.423 52.225-116.647 116.648-116.647m0 42.666c-40.859 0-73.981 33.123-73.981 74.062a73.76 73.76 0 0 0 21.603 52.296c13.867 13.867 32.685 21.64 52.378 21.603zm234.666 52.647v42.667h-85.333v-42.667zm-384 0v42.667H21.333v-42.667zM105.15 74.98l60.34 60.34l-30.17 30.17l-60.34-60.34zm301.7 0l30.169 30.17l-60.34 60.34l-30.17-30.17zM277.332 21.333v85.333h-42.667V21.333z" />
            </svg>
          </button>
        </li>
      </ul>
    </nav>
  </div>
</header>

<div class="nav-drawer" id="nav-menu" data-nav-drawer>
  <div class="nav-drawer-overlay" data-nav-close></div>
  <div class="nav-drawer-content">
    <div class="nav-drawer-header">
      <button class="nav-drawer-close" data-nav-close aria-label="Close menu">
        &times;
      </button>
    </div>
    <nav class="nav-drawer-nav">
      <ul>
        {navItems.map(item => (
          <li>
            <a
              href={item.href}
              class={currentPath === item.href ? 'active' : ''}
            >
              {item.label}
            </a>
          </li>
        ))}
      </ul>
      <div class="drawer-footer">
        <button
          id="theme-toggle-mobile"
          class="theme-toggle-mobile"
          aria-label="Toggle theme"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path
              fill="currentColor" fill-rule="evenodd" d="M277.333 405.333v85.333h-42.667v-85.333zm99.346-58.824l60.34 60.34l-30.17 30.17l-60.34-60.34zm-241.359 0l30.17 30.17l-60.34 60.34l-30.17-30.17zM256 139.353c64.422 0 116.647 52.224 116.647 116.647c0 64.422-52.225 116.647-116.647 116.647A116.427 116.427 0 0 1 139.352 256c0-64.423 52.225-116.647 116.648-116.647m0 42.666c-40.859 0-73.981 33.123-73.981 74.062a73.76 73.76 0 0 0 21.603 52.296c13.867 13.867 32.685 21.64 52.378 21.603zm234.666 52.647v42.667h-85.333v-42.667zm-384 0v42.667H21.333v-42.667zM105.15 74.98l60.34 60.34l-30.17 30.17l-60.34-60.34zm301.7 0l30.169 30.17l-60.34 60.34l-30.17-30.17zM277.332 21.333v85.333h-42.667V21.333z" />
          </svg>
          <span>Toggle Theme</span>
        </button>
      </div>
    </nav>
  </div>
</div>

<script>
  function initNavigation() {
    const toggle = document.querySelector('[data-nav-toggle]');
    const drawer = document.querySelector('[data-nav-drawer]');
    const closeButtons = document.querySelectorAll('[data-nav-close]');

    if (toggle && drawer) {
      const toggleDrawer = () => {
        drawer.classList.toggle('is-open');
        const isOpen = drawer.classList.contains('is-open');
        toggle.setAttribute('aria-expanded', isOpen.toString());

        if (isOpen) {
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = '';
        }
      };

      toggle.addEventListener('click', toggleDrawer);

      closeButtons.forEach(btn => {
        btn.addEventListener('click', toggleDrawer);
      });
    }

    // Theme toggle
    const themeToggle = document.getElementById('theme-toggle');
    const themeToggleMobile = document.getElementById('theme-toggle-mobile');

    // Initialize theme from localStorage or default to light
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);

    const toggleTheme = () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';

      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    };

    if (themeToggle) {
      themeToggle.addEventListener('click', toggleTheme);
    }

    if (themeToggleMobile) {
      themeToggleMobile.addEventListener('click', toggleTheme);
    }
  }

  initNavigation();
  document.addEventListener('astro:after-swap', initNavigation);
</script>

<style>
  .nav-header {
    border-bottom: 1px solid var(--pico-muted-border-color);
    padding: 0;
    margin-bottom: 0;
  }

  .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .nav-logo {
    text-decoration: none;
    color: var(--pico-color);
    font-size: 1.1rem;
    display: flex;
    align-items: center;
  }

  .nav-logo:hover {
    color: var(--pico-primary);
  }

  .nav-logo-img {
    height: 2rem;
    width: auto;
    display: block;
  }

  .nav-mobile-toggle {
    display: none;
    background: none;
    border: none;
    color: var(--pico-color);
    cursor: pointer;
    padding: 0.5rem;
    font-size: 0.9rem;
  }

  .nav-desktop {
    display: block;
  }

  .nav-items {
    display: flex;
    list-style: none;
    gap: 2rem;
    margin: 0;
    padding: 0;
    align-items: center;
  }

  .nav-items li {
    margin: 0;
    padding: 0;
  }

  .nav-link {
    text-decoration: none;
    color: var(--pico-muted-color);
    transition: color 0.2s;
    font-size: 0.95rem;
    padding: 0.25rem 0;
    display: inline-block;
    background: none;
    border: none;
    border-radius: 0;
  }

  .nav-link:hover,
  .nav-link.active {
    color: var(--pico-primary);
    background: none;
  }

  .nav-link.active {
    border-bottom: 2px solid var(--pico-primary);
  }

  .theme-toggle {
    background: none;
    border: none;
    color: var(--pico-muted-color);
    cursor: pointer;
    padding: 0.25rem;
    display: flex;
    align-items: center;
    transition: color 0.2s;
  }

  .theme-toggle:hover {
    color: var(--pico-primary);
  }

  .theme-toggle svg {
    width: 1.25rem;
    height: 1.25rem;
  }

  .nav-drawer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
  }

  .nav-drawer.is-open {
    opacity: 1;
    visibility: visible;
  }

  .nav-drawer-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    cursor: pointer;
  }

  .nav-drawer-content {
    position: absolute;
    top: 0;
    right: 0;
    width: 80%;
    max-width: 300px;
    height: 100%;
    background: var(--pico-background-color);
    transform: translateX(100%);
    transition: transform 0.3s;
    display: flex;
    flex-direction: column;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
  }

  .nav-drawer.is-open .nav-drawer-content {
    transform: translateX(0);
  }

  .nav-drawer-header {
    display: flex;
    justify-content: flex-end;
    padding: 1rem;
    border-bottom: 1px solid var(--pico-muted-border-color);
  }

  .nav-drawer-close {
    background: none;
    border: none;
    color: var(--pico-color);
    cursor: pointer;
    font-size: 2rem;
    line-height: 1;
    padding: 0;
    width: 2rem;
    height: 2rem;
  }

  .nav-drawer-nav {
    flex: 1;
    padding: 1rem;
  }

  .nav-drawer-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .nav-drawer-nav li {
    margin: 0;
  }

  .nav-drawer-nav a {
    display: block;
    padding: 0.75rem 1rem;
    text-decoration: none;
    color: var(--pico-muted-color);
    border-radius: var(--pico-border-radius);
    transition: background-color 0.2s, color 0.2s;
  }

  .nav-drawer-nav a:hover,
  .nav-drawer-nav a.active {
    background-color: var(--pico-primary-background);
    color: var(--pico-primary);
  }

  .drawer-footer {
    margin-top: auto;
    padding: 1rem;
    border-top: 1px solid var(--pico-muted-border-color);
  }

  .theme-toggle-mobile {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: none;
    border: none;
    border-radius: var(--pico-border-radius);
    color: var(--pico-muted-color);
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
    text-align: left;
  }

  .theme-toggle-mobile:hover {
    background-color: var(--pico-primary-background);
    color: var(--pico-primary);
  }

  .theme-toggle-mobile svg {
    width: 1.25rem;
    height: 1.25rem;
  }

  @media (max-width: 768px) {
    .nav-mobile-toggle {
      display: block;
    }

    .nav-desktop {
      display: none;
    }

    .nav-container {
      padding: 0.75rem 1rem;
    }
  }
</style>
